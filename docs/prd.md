# XBoost Trader - 智能网格交易CLI工具

## 项目概述

**项目名称**: XBoost Trader  
**版本**: v1.0  
**日期**: 2025-09-12  
**作者**: John (Product Manager)

## Goals and Background Context

**Goals:**
- 为DeFi交易者提供基于OKX DEX SDK的智能网格交易自动化工具
- 在震荡市场中通过高频买卖获取稳定收益
- 优先支持Linea网络，避免Ethereum高gas费用
- 提供简洁CLI界面，支持多种网格策略
- 通过合规的网格交易策略产生高频交易量

**Background Context:**

网格交易是一种在价格区间内设置多层买卖订单的量化交易策略，特别适合震荡行情。通过在低位买入、高位卖出，累积获取价差收益。与传统人工交易相比，自动化网格交易能够7×24小时执行，不错过任何交易机会。

**技术基础**: OKX DEX SDK (https://github.com/okx/okx-dex-sdk) 提供了强大的多链交换能力、实时价格数据和交易执行功能，支持Ethereum、Linea、BNB Chain、Solana等网络，为构建高频网格交易工具提供了理想的技术基础。

考虑到Ethereum的高gas费用会大幅降低网格交易的盈利性，MVP版本将优先支持Linea网络，享受Layer 2的低费用优势。

## 需求规格

### 核心功能需求 (按优先级排序)

#### 1. 网格策略执行引擎 - P0
**描述**: 自动化网格交易策略的核心执行引擎
**验收标准**:
- 支持等差网格和等比网格两种模式
- 自动在网格价位设置买卖订单
- 订单成交后自动在对应位置设置反向订单
- 支持网格参数动态调整

#### 2. 风险管理和止损机制 - P0  
**描述**: 保护资金安全的风险控制系统
**验收标准**:
- 止损价位设置，防止单边下跌损失
- 最大持仓限制，控制资金暴露
- 异常监控和紧急停止机制
- Gas费用预估和优化

#### 3. 实时行情监控和价格追踪 - P1
**描述**: 持续监控目标交易对的价格变化
**验收标准**:
- 实时价格数据获取和显示
- 价格变化趋势分析
- 网格覆盖率监控
- 交易机会识别和提醒

#### 4. 多网格策略管理 - P1
**描述**: 支持同时运行多个网格策略
**验收标准**:
- 不同交易对的独立网格配置
- 策略间资金隔离
- 统一的策略启停控制
- 策略性能对比分析

#### 5. 交易统计和收益分析 - P2
**描述**: 提供详细的交易数据统计和盈亏分析
**验收标准**:
- 实时收益率计算
- 交易次数和成交额统计
- 手续费成本分析
- 历史交易记录查询

### 技术需求

#### 支持的区块链网络 (优先级排序)
1. **Linea**: MVP优先支持，低gas费用，高性能Layer 2
2. **BNB Chain**: 第二优先级，低费用，高流动性
3. **Ethereum**: 高gas费用，但流动性最佳
4. **Solana**: 高性能，适合高频交易

#### 架构要求
- **CLI界面**: 简洁命令结构，易于脚本化和监控
- **配置管理**: YAML/JSON配置文件管理策略参数
- **SDK集成**: 基于OKX DEX SDK (https://github.com/okx/okx-dex-sdk) 构建
- **数据存储**: 本地SQLite数据库存储交易记录和策略状态
- **安全存储**: 私钥AES-256加密存储，支持密码保护

## 用户故事

### Epic 0: 项目架构初始化 - 技术基础设施
**Epic Goal**: 为XBoost Trader建立完整的技术基础架构和开发环境，实现从概念到可开发状态的转换

**作为** 开发团队  
**我们需要** 建立项目的技术基础架构  
**以便** 为后续功能开发提供坚实的技术基础  

#### 核心技术故事:
- **Story 0.1**: 项目结构和构建系统初始化
- **Story 0.2**: 数据库架构和连接层实现  
- **Story 0.3**: 核心服务接口和基础实现
- **Story 0.4**: CLI框架和基础命令实现
- **Story 0.5**: 安全和加密基础设施
- **Story 0.6**: 测试框架和CI/CD基础

> 📋 **详细Epic文档**: [epic-0-project-initialization.md](./epic-0-project-initialization.md)

---

### Epic 1: 核心网格交易功能
**Epic Goal**: 建立基础的网格交易引擎，支持自动化买卖执行和基本监控

**作为** 量化交易者  
**我希望** 设置网格交易参数并自动执行买卖  
**以便** 在震荡行情中持续获取价差收益  

#### 用户故事集:

**Story 1.1: 网格策略创建与配置**
- **作为** 网格交易者
- **我希望** 通过CLI命令创建网格策略并设置基本参数
- **以便** 定义我的交易策略框架
- **验收标准**:
  - 支持设置交易对(如ETH/USDC)
  - 配置价格区间(upper_price, lower_price)
  - 设置网格数量(grid_count)
  - 选择网格类型(等差/等比)
  - 设置基础交易金额(base_amount)

**Story 1.2: 网格策略启动与执行**
- **作为** 网格交易者
- **我希望** 启动网格策略并自动执行买卖订单
- **以便** 开始捕捉价格波动获利
- **验收标准**:
  - 策略启动时在当前价格上下设置买卖网格
  - 自动监控价格变化
  - 当价格触及买入网格时自动执行买入
  - 当价格触及卖出网格时自动执行卖出
  - 订单成交后在对应位置设置反向订单

**Story 1.3: 实时策略监控与状态查看**
- **作为** 网格交易者
- **我希望** 实时查看策略执行状态和当前持仓
- **以便** 了解策略表现和资金状况
- **验收标准**:
  - 显示策略运行状态(运行中/已停止/错误)
  - 实时显示当前价格和网格覆盖情况
  - 查看当前持仓和可用余额
  - 显示未成交订单列表
  - 展示实时盈亏情况

**Story 1.4: 基础交易统计与历史记录**
- **作为** 网格交易者
- **我希望** 查看交易历史和基本统计数据
- **以便** 评估策略效果
- **验收标准**:
  - 显示总交易次数和成交金额
  - 计算累计盈亏和收益率
  - 查看最近N天的交易记录
  - 统计买卖订单成交分布

### Epic 2: 风险管理
**Epic Goal**: 构建完整的风险控制体系，保护用户资金安全

**作为** 谨慎的交易者  
**我希望** 设置止损和风控参数  
**以便** 在市场出现不利变化时保护资金  

#### 用户故事集:

**Story 2.1: 止损机制设置**
- **作为** 风险控制交易者
- **我希望** 为网格策略设置止损价位
- **以便** 在价格大幅下跌时自动停止策略并清仓
- **验收标准**:
  - 支持设置全局止损价位
  - 支持按策略设置独立止损
  - 触发止损时自动停止网格执行
  - 止损触发后自动清理所有未成交订单
  - 可选择是否自动卖出当前持仓

**Story 2.2: 仓位与资金管理**
- **作为** 风险控制交易者
- **我希望** 设置最大持仓限制和资金使用比例
- **以便** 控制单个策略的资金暴露
- **验收标准**:
  - 设置单个策略最大资金使用比例
  - 限制单边持仓的最大数量
  - 当达到仓位限制时暂停买入订单
  - 保留一定比例资金作为安全缓冲
  - 支持动态调整仓位限制

**Story 2.3: 异常监控与紧急停止**
- **作为** 风险控制交易者
- **我希望** 系统能检测异常情况并提供紧急停止功能
- **以便** 在出现技术问题时快速止损
- **验收标准**:
  - 检测网络连接异常和API错误
  - 监控价格数据异常波动
  - 检测订单执行失败率过高
  - 提供一键紧急停止所有策略功能
  - 异常情况自动发送告警通知

**Story 2.4: Gas费用优化与控制**
- **作为** 成本敏感的交易者
- **我希望** 优化和控制交易的Gas费用
- **以便** 提高网格交易的净收益
- **验收标准**:
  - 实时评估Gas价格并选择合适时机执行
  - 设置最大可接受的Gas费用阈值
  - 当Gas费用过高时暂停交易
  - 批量处理订单以降低总Gas成本
  - 显示累计Gas费用统计

### Epic 3: 多策略管理  
**Epic Goal**: 实现多个网格策略的并行管理和统一监控

**作为** 专业交易者  
**我希望** 同时运行多个网格策略  
**以便** 分散风险并提高资金利用率  

#### 用户故事集:

**Story 3.1: 多策略配置管理**
- **作为** 专业交易者
- **我希望** 通过配置文件管理多个网格策略
- **以便** 高效配置和维护复杂的交易组合
- **验收标准**:
  - 支持在配置文件中定义多个策略
  - 每个策略独立配置参数和风控设置
  - 支持策略模板和快速复制
  - 配置文件验证和错误提示
  - 支持热重载配置文件

**Story 3.2: 策略间资金隔离**
- **作为** 专业交易者
- **我希望** 各个网格策略的资金相互隔离
- **以便** 确保单个策略问题不影响其他策略
- **验收标准**:
  - 每个策略分配独立的资金池
  - 策略间资金不会相互占用
  - 支持动态调整策略间的资金分配
  - 清晰显示各策略的资金使用情况
  - 提供资金再平衡功能

**Story 3.3: 统一策略控制台**
- **作为** 专业交易者
- **我希望** 通过统一界面管理所有策略的启停和状态
- **以便** 高效监控和控制多个策略
- **验收标准**:
  - 显示所有策略的运行状态概览
  - 支持批量启动/停止策略
  - 快速切换单个策略的启停状态
  - 显示策略性能排行和对比
  - 提供策略组管理功能

**Story 3.4: 跨策略分析与报告**
- **作为** 专业交易者
- **我希望** 查看所有策略的综合分析和表现报告
- **以便** 优化整体投资组合表现
- **验收标准**:
  - 汇总显示所有策略的总盈亏
  - 对比各策略的收益率和风险指标
  - 分析不同交易对的表现差异
  - 生成策略表现的时间序列图表
  - 导出详细的策略分析报告

**Story 3.5: 策略自动化与智能调优**
- **作为** 专业交易者
- **我希望** 系统能根据市场情况自动优化策略参数
- **以便** 在不同市场环境下维持最佳表现
- **验收标准**:
  - 检测市场波动性变化
  - 根据历史表现调整网格间距
  - 自动暂停表现不佳的策略
  - 在趋势市场中调整策略参数
  - 提供策略优化建议  

## 技术规格

### CLI命令设计

```bash
# 基本配置
xboost init                          # 初始化配置
xboost config add-wallet <address>   # 添加钱包(私钥加密存储)
xboost config set-network <network>  # 设置默认网络

# 网格策略管理
xboost grid create <pair> --upper <price> --lower <price> --grids <num>
xboost grid start <strategy-id>      # 启动网格策略
xboost grid stop <strategy-id>       # 停止网格策略
xboost grid status                   # 查看所有策略状态
xboost grid list                     # 列出所有策略

# 监控和分析
xboost monitor --strategy <id>       # 监控指定策略
xboost stats --strategy <id>         # 查看策略统计
xboost balance                       # 查看账户余额
xboost history --days <num>          # 查看交易历史

# 风险管理
xboost grid set-stop-loss <strategy-id> <price>
xboost grid set-max-position <strategy-id> <amount>
```

### 配置文件结构

```yaml
# config.yaml
wallets:
  - address: "0x..."
    networks: ["linea", "bnb"]
    encrypted_key_file: ".keys/wallet1.enc"

networks:
  linea:
    rpc_url: "https://rpc.linea.build"
    gas_price_strategy: "fast"
  bnb:
    rpc_url: "https://bsc-dataseed.binance.org"
    gas_price_strategy: "standard"

strategies:
  - id: "eth-usdc-grid-1"
    pair: "ETH/USDC"
    network: "linea"
    grid_type: "arithmetic"  # arithmetic | geometric
    upper_price: 2100
    lower_price: 1900
    grid_count: 20
    base_amount: 100
    stop_loss: 1800
    max_position_ratio: 0.8
    
  - id: "bnb-usdt-grid-1"
    pair: "BNB/USDT"
    network: "bnb"
    grid_type: "geometric"
    upper_price: 350
    lower_price: 250
    grid_count: 15
    base_amount: 50
    stop_loss: 230

global_settings:
  max_slippage: 0.5%
  gas_optimization: true
  auto_restart: true
  notification_webhook: "https://hooks.slack.com/..."
```

### 网格策略算法

#### 等差网格 (Arithmetic Grid)
```
价格区间: $1900 - $2100
网格数量: 20
网格间距: ($2100 - $1900) / 20 = $10

网格价位:
$2100 ← 卖出
$2090 ← 卖出
...
$2010 ← 卖出
$2000 ← 当前价格
$1990 ← 买入
...
$1910 ← 买入  
$1900 ← 买入
```

#### 等比网格 (Geometric Grid)
```
价格区间: $1900 - $2100  
网格数量: 20
比率: (2100/1900)^(1/20) ≈ 1.0052

网格价位按比率递增递减
```

## 成功指标

### 产品指标
- **策略胜率**: > 70% (盈利策略占比)
- **平均日收益**: > 0.5% (扣除手续费后)
- **最大回撤**: < 10%
- **交易成功率**: > 95% (订单执行成功率)

### 技术指标  
- **订单延迟**: < 3秒 (从信号到订单执行)
- **系统可用性**: > 99.5%
- **价格数据准确性**: < 0.1% 偏差
- **内存使用**: < 100MB (单策略)

### 交易指标
- **日均交易次数**: > 50 (单策略)
- **Gas费用占比**: < 2% (相对于交易额)
- **滑点控制**: 平均滑点 < 0.1%

## 风险评估

### 技术风险
- **OKX DEX SDK依赖**: 缓解方案 - 实现多DEX路由和备用数据源
- **网络拥堵**: 缓解方案 - 智能gas调整和优先级队列
- **私钥安全**: 缓解方案 - AES-256加密存储，主密码保护

### 市场风险
- **单边行情**: 缓解方案 - 止损机制和趋势识别
- **流动性不足**: 缓解方案 - 动态调整交易量和滑点限制
- **闪电崩盘**: 缓解方案 - 异常检测和紧急停止

### 策略风险
- **参数设置不当**: 缓解方案 - 参数验证和建议配置
- **过度交易**: 缓解方案 - 最小间隔时间和交易频率限制
- **资金管理**: 缓解方案 - 仓位控制和风险预警

## 发布计划

### Phase 0 - 项目架构初始化 (2周)
- 项目结构和构建系统搭建
- 数据库架构实现和迁移系统
- 核心服务接口定义
- CLI框架和基础命令
- 安全基础设施和私钥加密
- 测试框架和CI/CD配置

### Phase 1 - MVP核心功能 (4周)
- 基于Phase 0基础的功能实现
- Linea网络集成和OKX SDK集成
- 基本网格策略执行引擎
- 等差网格算法实现
- 基础风险控制机制

### Phase 2 - 策略增强 (3周)
- 等比网格算法
- 多策略并行执行
- 实时监控和统计
- BNB Chain网络支持

### Phase 3 - 高级功能 (3周)
- 动态网格调整
- 智能止损机制
- 历史数据分析
- 性能优化

### Phase 4 - 生产就绪 (2周)
- Ethereum和Solana网络支持
- 高级风险管理
- 监控告警系统
- 文档和用户指南

---

**变更日志**

| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2025-09-12 | 1.0 | 重新设计为网格交易CLI工具，优先支持Linea | John |